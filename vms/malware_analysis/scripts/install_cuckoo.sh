#!/bin/sh

# Requirements

## Virtualbox
sudo apt-get install virtualbox -y
sudo DEBIAN_FRONTEND=noninteractive apt-get -y install virtualbox-ext-pack

## Installing Python libraries
sudo apt-get install python2 -y
curl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py
python2 get-pip.py
sudo apt-get install python-dev libffi-dev libssl-dev -y
python2 -m pip install virtualenv
sudo apt-get install python-setuptools -y
sudo apt-get install libjpeg-dev zlib1g-dev swig -y

## Use Django-based Web Interface
sudo apt-get install mongodb -y

## Install tcpdump
sudo apt-get install tcpdump apparmor-utils -y
sudo aa-disable /usr/sbin/tcpdump

sudo adduser cuckoo
sudo groupadd pcap
sudo usermod -a -G pcap cuckoo
sudo chgrp pcap /usr/sbin/tcpdump
sudo setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump

sudo apt-get install libcap2-bin -y
#11
sudo sh -c "echo \"deb http://security.ubuntu.com/ubuntu bionic-security main\" >> /etc/apt/sources.list"
sudo apt update && apt-cache policy libssl1.0-dev
sudo apt-get install libssl1.0-dev -y
python2 -m pip install m2crypto==0.24.0

#12
sudo apt install make gcc g++ libcairo2-dev libjpeg-turbo8-dev libpng-dev libtool-bin libossp-uuid-dev libavcodec-dev libavutil-dev libswscale-dev freerdp2-dev libpango1.0-dev libssh2-1-dev libvncserver-dev libtelnet-dev libssl-dev libvorbis-dev libwebp-dev -y
sudo apt install tomcat9 tomcat9-admin tomcat9-common tomcat9-user -y
sudo systemctl start tomcat9
sudo systemctl enable tomcat9
wget https://downloads.apache.org/guacamole/1.3.0/source/guacamole-server-1.3.0.tar.gz
tar -xvzf guacamole-server-1.3.0.tar.gz
cd guacamole-server-1.3.0
sudo ./configure --with-init-dir=/etc/init.d --host=x86_64
sudo make
sudo make install
sudo ldconfig
sudo systemctl enable guacd
sudo systemctl start guacd
wget https://mirrors.estointernet.in/apache/guacamole/1.3.0/binary/guacamole-1.3.0.war
sudo mkdir /etc/guacamole
sudo mv guacamole-1.3.0.war /etc/guacamole/guacamole.war
sudo ln -s /etc/guacamole/guacamole.war /var/lib/tomcat9/webapps/
sudo systemctl restart tomcat9
sudo systemctl restart guacd

# Installing Cuckoo

## add groups
sudo usermod -a -G vboxusers $USER

## Install Cuckoo
python2 -m pip install -U pip setuptools
python2 -m pip install -U cuckoo

# Install Vagrant
sudo apt install vagrant -y

## ubuntuが最小構成だった場合はrubyがないので要インストール
sudo apt install ruby -y

## Requirements
sudo gem install winrm
sudo gem install winrm-elevated
