#!/bin/sh

# Requirements

## Virtualbox
sudo apt-get install virtualbox -y
sudo DEBIAN_FRONTEND=noninteractive apt-get -y install virtualbox-ext-pack

## Installing Python libraries
sudo apt-get install python2 -y
curl https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py
python2 get-pip.py
sudo apt-get install python-dev libffi-dev libssl-dev -y
python2 -m pip install virtualenv
sudo apt-get install python-setuptools -y
sudo apt-get install libjpeg-dev zlib1g-dev swig -y

## Use Django-based Web Interface
sudo apt-get install mongodb -y

## Install tcpdump
sudo apt-get install tcpdump apparmor-utils -y
sudo aa-disable /usr/sbin/tcpdump

sudo adduser cuckoo
sudo groupadd pcap
sudo usermod -a -G pcap cuckoo
sudo chgrp pcap /usr/sbin/tcpdump
sudo setcap cap_net_raw,cap_net_admin=eip /usr/sbin/tcpdump

sudo apt-get install libcap2-bin -y
python2 -m pip install m2crypto==0.24.0

## Install guacd
sudo add-apt-repository ppa:guacamole/stable
sudo apt-get install guacamole-tomcat
sudo apt install libguac-client-rdp0 libguac-client-vnc0 libguac-client-ssh0 guacd -y

# Installing Cuckoo

## add groups
sudo usermod -a -G vboxusers $USER

## Install Cuckoo
python2 -m pip install -U pip setuptools
python2 -m pip install -U cuckoo

# Install Vagrant
sudo apt install vagrant -y

## ubuntuが最小構成だった場合はrubyがないので要インストール
sudo apt install ruby -y

## Requirements
sudo gem install winrm
sudo gem install winrm-elevated
